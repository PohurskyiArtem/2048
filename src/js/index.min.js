"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var App=function(){function a(){_classCallCheck(this,a)}return _createClass(a,[{key:"createAndAppend",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{className:b,parentElement:c,value:d,tagName:"div"},b=a.className,c=a.parentElement,d=a.value,e=a.tagName,f=document.createElement(e);return f.className=b,d?f.innerHTML=d:null,c&&c.appendChild(f),f}},{key:"getRandomInt",value:function(a,b){var c=Math.floor;return c(Math.random()*(b-a+1))+a}},{key:"gameFieldToArray",value:function(a){var b=[];if(""!==a){for(var c=a.split("||"),d=0;d<c.length;d++){for(var e,f=c[d].split("&"),g=[],h=0;h<f.length;h++)e=+f[h],g.push([e]);b.push(g)}return b}return!1}},{key:"findItemInLocalStorage",value:function(a){for(var b in localStorage)if(localStorage.hasOwnProperty(b)&&b===a)return localStorage.getItem(a);return!1}}],[{key:"gameFieldToString",value:function(a){for(var b,c=[],d=[],e=0;e<a.length;e++){b=[];for(var f=0;f<a[e].length;f++)b.push([a[e][f]._value]);d.push(b)}for(var g=0;g<d.length;g++)c.push(d[g].join("&"));var h=c.join("||");return h}}]),a}();function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var c,d=_getPrototypeOf(a);if(b){var e=_getPrototypeOf(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return _possibleConstructorReturn(this,c)}}function _possibleConstructorReturn(a,b){return b&&("object"===_typeof(b)||"function"==typeof b)?b:_assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function _get(a,b,c){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(a,b,c){var d=_superPropBase(a,b);if(d){var e=Object.getOwnPropertyDescriptor(d,b);return e.get?e.get.call(c):e.value}},_get(a,b,c||a)}function _superPropBase(a,b){for(;!Object.prototype.hasOwnProperty.call(a,b)&&(a=_getPrototypeOf(a),null!==a););return a}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}var Cell=function(a){function b(a,d,e){var f,g;return _classCallCheck(this,b),g=c.call(this),g.game=d,g.fieldElement=a,g.element=_get((f=_assertThisInitialized(g),_getPrototypeOf(b.prototype)),"createAndAppend",f).call(f,{className:"game-field__cell",parentElement:a}),null==e?.8<Math.random()&&g.spawn():g.spawn(e),g}_inherits(b,a);var c=_createSuper(b);return _createClass(b,[{key:"spawn",value:function(a){this.value="number"==typeof a?a:.85<Math.random()?4:2,this.highlight("game-field__cell-highlight-new")}},{key:"clear",value:function(){this.value=""}},{key:"merge",value:function(a){this.value&&this.game.onCellMerge(this.value+a.value),new AnimateCell(a,this),this.value+=a.value,this.highlight(),a.clear()}},{key:"isSameTo",value:function(a){return this.value==a.value}},{key:"highlight",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"game-field__cell-highlight";this.element.className="game-field__cell "+a;var b=new Date;this.highlightStartTime=b,setTimeout(function(){b==this.highlightStartTime&&(this.element.className="game-field__cell")}.bind(this),200)}},{key:"value",get:function(){return this._value||0},set:function(a){this._value=a,this.element.innerHTML=0==a?"":a,this.element.setAttribute("data-cell",a)}},{key:"isEmpty",get:function(){return 0==this.value}}]),b}(App),AnimateCell=function(a){function b(a,d){var e,f;return _classCallCheck(this,b),f=c.call(this),f.element=_get((e=_assertThisInitialized(f),_getPrototypeOf(b.prototype)),"createAndAppend",e).call(e,{className:"game-field__cell game-field__cell-animate"}),f.element.setAttribute("data-cell",a.element.getAttribute("data-cell")),f.element.style.top=a.element.offsetTop+"px",f.element.style.left=a.element.offsetLeft+"px",a.fieldElement.appendChild(f.element),f.element.style.top=d.element.offsetTop+"px",f.element.style.left=d.element.offsetLeft+"px",setTimeout(function(){a.fieldElement.removeChild(this.element)}.bind(_assertThisInitialized(f)),1e3),f}_inherits(b,a);var c=_createSuper(b);return b}(Cell);function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}function _inherits(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&_setPrototypeOf(a,b)}function _setPrototypeOf(a,b){return _setPrototypeOf=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},_setPrototypeOf(a,b)}function _createSuper(a){var b=_isNativeReflectConstruct();return function(){var c,d=_getPrototypeOf(a);if(b){var e=_getPrototypeOf(this).constructor;c=Reflect.construct(d,arguments,e)}else c=d.apply(this,arguments);return _possibleConstructorReturn(this,c)}}function _possibleConstructorReturn(a,b){return b&&("object"===_typeof(b)||"function"==typeof b)?b:_assertThisInitialized(a)}function _assertThisInitialized(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(a){return!1}}function _get(a,b,c){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(a,b,c){var d=_superPropBase(a,b);if(d){var e=Object.getOwnPropertyDescriptor(d,b);return e.get?e.get.call(c):e.value}},_get(a,b,c||a)}function _superPropBase(a,b){for(;!Object.prototype.hasOwnProperty.call(a,b)&&(a=_getPrototypeOf(a),null!==a););return a}function _getPrototypeOf(a){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},_getPrototypeOf(a)}var Game=function(a){function b(a){var d,e,f,g,h,j,l,m,n,o,p,q,r,s=1<arguments.length&&void 0!==arguments[1]?arguments[1]:4;_classCallCheck(this,b),r=c.call(this);var t=_get((d=_assertThisInitialized(r),_getPrototypeOf(b.prototype)),"gameFieldToArray",d).call(d,_get((e=_assertThisInitialized(r),_getPrototypeOf(b.prototype)),"findItemInLocalStorage",e).call(e,"savedGame")||""),u=_get((f=_assertThisInitialized(r),_getPrototypeOf(b.prototype)),"findItemInLocalStorage",f).call(f,"savedScore");r.size=t?t.length:s;var v=_get((g=_assertThisInitialized(r),_getPrototypeOf(b.prototype)),"createAndAppend",g).call(g,{className:"game-container",parentElement:a});r.headerElement=_get((h=_assertThisInitialized(r),_getPrototypeOf(b.prototype)),"createAndAppend",h).call(h,{className:"game-header",parentElement:v}),r.gameScoreContainer=_get((j=_assertThisInitialized(r),_getPrototypeOf(b.prototype)),"createAndAppend",j).call(j,{className:"game-score-container",parentElement:r.headerElement}),r.gameScoreItem=_get((l=_assertThisInitialized(r),_getPrototypeOf(b.prototype)),"createAndAppend",l).call(l,{className:"game-score-item",parentElement:r.gameScoreContainer}),r.bestGameScoreItem=_get((m=_assertThisInitialized(r),_getPrototypeOf(b.prototype)),"createAndAppend",m).call(m,{className:"game-best-score-item",parentElement:r.gameScoreContainer});var w=_get((n=_assertThisInitialized(r),_getPrototypeOf(b.prototype)),"createAndAppend",n).call(n,{className:"new-game_btn",parentElement:r.headerElement}),x=_get((o=_assertThisInitialized(r),_getPrototypeOf(b.prototype)),"createAndAppend",o).call(o,{className:"previous-state_btn",parentElement:r.headerElement});r.score=+u||0,r.bestScore=_get((p=_assertThisInitialized(r),_getPrototypeOf(b.prototype)),"findItemInLocalStorage",p).call(p,"best_score")||0;var y=_get((q=_assertThisInitialized(r),_getPrototypeOf(b.prototype)),"createAndAppend",q).call(q,{className:"game-field",parentElement:v});r.field=[];var z,A;for(z=0;z<s;z+=1)for(r.field[z]=[],A=0;A<s;A+=1){var B=t.length?t[z][A][0]:null;r.field[z][A]=new Cell(y,_assertThisInitialized(r),B)}return addEventListener("keyup",function(a){switch(a.keyCode){case 38:r.moveUp();break;case 40:r.moveDown();break;case 37:r.moveLeft();break;case 39:r.moveRight();}}),w.addEventListener("click",function(){r.field=0,r.score=0,location.href=location.href}),x.addEventListener("click",function(){new Promise(function(a){location.href=location.href,a()}).then(function(){localStorage.setItem("savedGame",localStorage.getItem("previousMove")),localStorage.setItem("savedScore",localStorage.getItem("previousMoveScore"))})}),window.onbeforeunload=function(){localStorage.setItem("savedGame",App.gameFieldToString(game.field)),localStorage.setItem("savedScore",game.score)},r}_inherits(b,a);var c=_createSuper(b);return _createClass(b,[{key:"spawnUnit",value:function(){var a,c,d=[];for(a=0;a<this.field.length;a+=1)for(c=0;c<this.field.length;c+=1)this.field[a][c].value||d.push(this.field[a][c]);if(d.length){var e=d[_get(_getPrototypeOf(b.prototype),"getRandomInt",this).call(this,0,d.length-1)];e.spawn(e)}else alert("You lose!")}},{key:"moveRight",value:function(){this.saveCurrentField(this.field),this.saveCurrentScore(this.score);var a,b,c,d,e,f;for(a=0;a<this.size;a+=1)for(b=this.size-2;0<=b;b-=1)if(f=this.field[a][b],!(f.isEmpty&&this.field[a][b+1].isEmpty))for(d=b+1;d<this.size;){if(c=this.field[a][d],!c.isEmpty||this.isLastKey(d)){c.isEmpty&&this.isLastKey(d)||c.isSameTo(f)?(this.field[a][d].merge(f),e=!0):!c.isEmpty&&d-1!=b&&(this.field[a][d-1].merge(f),e=!0);break}d+=1,c=this.field[a][d]}e&&this.spawnUnit()}},{key:"isLastKey",value:function(a){return a==this.size-1}},{key:"isFirstKey",value:function(a){return 0==a}},{key:"moveLeft",value:function(){this.saveCurrentField(this.field),this.saveCurrentScore(this.score);var a,b,c,d,e,f;for(a=0;a<this.size;a+=1)for(b=1;b<this.size;b+=1)if(f=this.field[a][b],!f.isEmpty)for(d=b-1;0<=d;){if(c=this.field[a][d],!c.isEmpty||this.isFirstKey(d)){c.isEmpty&&this.isFirstKey(d)||c.isSameTo(f)?(this.field[a][d].merge(f),e=!0):!c.isEmpty&&d+1!=b&&(this.field[a][d+1].merge(f),e=!0);break}d-=1,c=this.field[a][d]}e&&this.spawnUnit()}},{key:"moveDown",value:function(){this.saveCurrentField(this.field),this.saveCurrentScore(this.score);var a,b,c,d,e,f;for(b=0;b<this.size;b+=1)for(a=this.size-2;0<=a;a-=1)if(f=this.field[a][b],!f.isEmpty)for(d=a+1;d<this.size;){if(c=this.field[d][b],!c.isEmpty||this.isLastKey(d)){c.isEmpty&&this.isLastKey(d)||c.isSameTo(f)?(this.field[d][b].merge(f),e=!0):!c.isEmpty&&d-1!=a&&(this.field[d-1][b].merge(f),e=!0);break}d+=1,c=this.field[d][b]}e&&this.spawnUnit()}},{key:"moveUp",value:function(){this.saveCurrentField(this.field),this.saveCurrentScore(this.score);var a,b,c,d,e,f;for(b=0;b<this.size;b+=1)for(a=1;a<this.size;a+=1)if(f=this.field[a][b],!f.isEmpty)for(d=a-1;0<=d;){if(c=this.field[d][b],!c.isEmpty||this.isFirstKey(d)){c.isEmpty&&this.isFirstKey(d)||c.isSameTo(f)?(this.field[d][b].merge(f),e=!0):!c.isEmpty&&d+1!=a&&(this.field[d+1][b].merge(f),e=!0);break}d-=1,c=this.field[d][b]}e&&this.spawnUnit()}},{key:"onCellMerge",value:function(a){this.score+=a,this.checkBestScore(this.score)&&(this.bestScore=this.score)}},{key:"saveCurrentField",value:function(a){localStorage.setItem("previousMove",App.gameFieldToString(a))}},{key:"saveCurrentScore",value:function(a){localStorage.setItem("previousMoveScore",a)}},{key:"checkBestScore",value:function(a){if(_get(_getPrototypeOf(b.prototype),"findItemInLocalStorage",this).call(this,"best_score")<a)return localStorage.setItem("best_score",a),!0}},{key:"score",set:function(a){this._score=a,this.gameScoreItem.innerHTML="Score: "+a+"</br>"},get:function(){return this._score}},{key:"bestScore",set:function(a){this._bestScore=a,this.bestGameScoreItem.innerHTML="Best score: "+a},get:function(){return this._bestScore}}]),b}(App);var game=new Game(document.body,4);
//# sourceMappingURL=index.min.js.map
